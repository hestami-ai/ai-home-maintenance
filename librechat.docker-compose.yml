# Do not edit this file directly. Use a ‘docker-compose.override.yaml’ file if you can.
# Refer to `docker-compose.override.yaml.example’ for some sample configurations.

networks:
  backend-dev:
    name: backend-dev
    external: true
  backend-prod:
    name: backend-prod
    external: true


services:
  api:
    container_name: LibreChat
    ports:
      - "3080:3080"
    depends_on:
      - mongodb
      - rag_api
    #image: ghcr.io/danny-avila/librechat-dev:latest
    image: librechat/librechat:v0.8.0
    restart: always
    #user: "${UID}:${GID}"  #Valid for Linux
    user: "0:0"  #Valid for Windows
    extra_hosts:
      - "host.docker.internal:host-gateway"
    env_file:
      - ./backend/LibreChat/.env
    volumes:
      - type: bind
        source: ./backend/LibreChat/.env
        target: /app/.env
      - type: bind
        source: ./backend/LibreChat/librechat.yaml
        target: /app/librechat.yaml
      - ./volumes/dev/librechat/images:/app/client/public/images
      - ./volumes/dev/librechat/uploads:/app/uploads
      - ./volumes/dev/librechat/logs:/app/logs
    networks:
      default:  # Keep LibreChat's internal network
      backend-dev:  # Add to Hestami AI backend network (dev)
        aliases:
          - librechat  # Add unique hostname to avoid conflict with Django's 'api' service
  mongodb:
    container_name: chat-mongodb
    image: mongo
    restart: always
    user: "0:0"
    volumes:
      - ./volumes/dev/librechat/data-node:/data/db
    env_file:
      - ./backend/LibreChat/.env
    command: mongod --noauth
    networks:
      - backend-dev
  meilisearch:
    container_name: chat-meilisearch
    image: getmeili/meilisearch:v1.12.3
    restart: always
    user: "0:0"
    env_file:
      - ./backend/LibreChat/.env
    volumes:
      - ./volumes/dev/librechat/meili_data_v1.12:/meili_data
    networks:
      - backend-dev
  vectordb:
    container_name: vectordb
    image: pgvector/pgvector:0.8.0-pg15-trixie
    env_file:
      - ./backend/LibreChat/.env
    restart: always
    volumes:
      - pgdata2:/var/lib/postgresql/data
    networks:
      - backend-dev
  rag_api:
    container_name: rag_api
    image: ghcr.io/danny-avila/librechat-rag-api-dev-lite:latest
    env_file:
      - ./backend/LibreChat/.env
    restart: always
    depends_on:
      - vectordb
    networks:
      - backend-dev

volumes:
  pgdata2:
