# =============================================================================
# Hestami AI OS - Environment Configuration
# =============================================================================
# Copy this file to .env and update values for your environment.
# NEVER commit .env to version control.
# =============================================================================

# -----------------------------------------------------------------------------
# Application
# -----------------------------------------------------------------------------
NODE_ENV=development
ORIGIN=http://localhost

# -----------------------------------------------------------------------------
# Reverse Proxy Configuration (for production behind Cloudflare/Traefik)
# -----------------------------------------------------------------------------
# These tell SvelteKit to trust X-Forwarded-* headers from your proxy chain
# ADDRESS_HEADER=X-Forwarded-For
# XFF_DEPTH=2
# PROTOCOL_HEADER=X-Forwarded-Proto
# HOST_HEADER=X-Forwarded-Host

# -----------------------------------------------------------------------------
# PostgreSQL Database
# -----------------------------------------------------------------------------
POSTGRES_USER=hestami
POSTGRES_PASSWORD=hestami_dev_password
POSTGRES_DB=hestami

# Application database user (RLS-enabled, used for runtime queries)
POSTGRES_APP_USER=hestami_app
POSTGRES_APP_PASSWORD=hestami_app_dev_password

# Prisma connection string - RLS-enabled user for runtime queries
# RLS policies filter data based on app.organization_id session variable
DATABASE_URL=postgresql://${POSTGRES_APP_USER}:${POSTGRES_APP_PASSWORD}@localhost:5432/${POSTGRES_DB}

# Admin connection string - bypasses RLS (for migrations, seeding, admin tasks)
# Uses superuser or owner role that is not subject to RLS policies
DATABASE_URL_ADMIN=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@localhost:5432/${POSTGRES_DB}

# Prisma Migrate uses this automatically (falls back to DATABASE_URL if not set)
PRISMA_MIGRATE_DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@localhost:5432/${POSTGRES_DB}

# DBOS system database URL - MUST use admin user (CREATEDB privilege required)
# DBOS creates its own system tables for workflow state, requires elevated permissions
DBOS_SYSTEM_DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@localhost:5432/${POSTGRES_DB}

# -----------------------------------------------------------------------------
# Redis
# -----------------------------------------------------------------------------
REDIS_PASSWORD=hestami_redis_dev
REDIS_URL=redis://:${REDIS_PASSWORD}@localhost:6379

# -----------------------------------------------------------------------------
# Authentication (Better-Auth)
# -----------------------------------------------------------------------------
# Generate with: openssl rand -base64 32
AUTH_SECRET=your-secret-key-change-in-production

# -----------------------------------------------------------------------------
# Activation Code Encryption
# -----------------------------------------------------------------------------
# 32-byte hex string (64 characters) for encrypting service provider activation codes
# Generate with: openssl rand -hex 32
HESTAMI_ACTIVATION_KEY=0000000000000000000000000000000000000000000000000000000000000000

# -----------------------------------------------------------------------------
# File Storage
# -----------------------------------------------------------------------------
# Directory for uploaded files (must be writable by the app)
# In Docker, this should match the container mount point
UPLOAD_DIR=/mnt/hestami-user-media

# -----------------------------------------------------------------------------
# Document Processing Queue (DPQ)
# -----------------------------------------------------------------------------
DPQ_AUTO_RETRY_ENABLED=true
DPQ_MAX_RETRY_ATTEMPTS=3
DPQ_RETRY_INTERVAL_SECONDS=300
DPQ_RETRY_BACKOFF_MULTIPLIER=2
DPQ_INFECTED_RETENTION_DAYS=30
DPQ_MAX_CONCURRENT_PER_ORG=5
DPQ_GLOBAL_MAX_CONCURRENT=20
DPQ_MAX_QUEUED_PER_ORG=50
DPQ_WORKER_URL=http://hestami-worker-document:8000
